/*!
 * Freetile.js v0.3.1
 * A dynamic layout plugin for jQuery.
 */
(function(e){"use strict";e.fn.freetile=function(n){if(typeof t[n]==="function"){return t[n].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof n==="object"||!n){return t.init.apply(this,arguments)}else{e.error("Method "+n+" does not exist on jQuery.Freetile")}return this};var t={init:function(e){var n=this,r=t.setupOptions(n,e),i=t.newContent(r.contentToAppend);if(!r.tiled)t.setupContainerBindings(n,r);if(r.tiled&&i){n.append(i);i.filter(r.selector||"*").filter(r.loadCheckSelector).imagesLoaded(function(){t.positionAll(n,r)})}else{n.children(r.loadCheckSelector).imagesLoaded(function(){t.positionAll(n,r)})}return n},append:function(e){var n=this,r=t.setupOptions(n,e),i=t.newContent(r.contentToAppend);if(r.tiled&&i){n.append(i);i.filter(r.loadCheckSelector).imagesLoaded(function(){t.positionAll(n,r)})}return n},layout:function(e){var n=this,r=t.setupOptions(n,e);t.positionAll(n,r);return n},destroy:function(){var n=this,r=n.data("FreetileData");t.resetElementsStyle(n,r);e(window).off("resize",this.windowResizeCallback);n.off(r.customEvents,this.customEventsCallback);return true},setupOptions:function(t,n){var r=t.data("FreetileData");var i=e.extend(true,{},this.defaults,r,this.reset,n);t.data("FreetileData",i);i.tiled=r!==undefined;i._animate=i.animate&&i.tiled&&e.isEmptyObject(i.contentToAppend);this.reset.callback=i.persistentCallback&&i.callback?i.callback:function(){};return i},windowResizeCallback:function(t,n,r){clearTimeout(t.data("FreetileTimeout"));t.data("FreetileTimeout",setTimeout(function(){var i=e(window),s=i.width(),o=i.height();if(s!=n||o!=r){n=s,r=o;t.freetile("layout")}},400))},customEventsCallback:function(e){clearTimeout(e.data("FreetileTimeout"));e.data("FreetileTimeout",setTimeout(function(){e.freetile("layout")},400))},setupContainerBindings:function(t,n){if(n.containerResize){var r=e(window),i=r.width(),s=r.height();r.resize(e.proxy(this.windowResizeCallback,t,t,i,s))}if(n.customEvents){t.bind(n.customEvents,e.proxy(this.customEventsCallback,t,t))}return t},newContent:function(t){if(typeof t==="object"&&!e.isEmptyObject(t)||typeof t==="string"&&e(t).length){return e(t)}return false},calculatePositions:function(t,n,r){n.each(function(t){var n=e(this),i=0;r.ElementWidth=n.outerWidth(true);r.ElementHeight=n.outerHeight(true);r.ElementTop=0;r.ElementIndex=t;r.IndexStart=0;r.IndexEnd=0;r.BestScore=0;r.TestedTop=0;r.TestedLeft=0;r.TestedTop=r.currentPos[0].top;for(i=1;i<r.currentPos.length&&r.currentPos[i].left<r.ElementWidth;i++){r.TestedTop=Math.max(r.TestedTop,r.currentPos[i].top)}r.ElementTop=r.TestedTop;r.IndexEnd=i;r.BestScore=r.scoreFunction(r);for(var t=1;t<r.currentPos.length&&r.currentPos[t].left+r.ElementWidth<=r.containerWidth;t++){r.TestedLeft=r.currentPos[t].left;r.TestedTop=r.currentPos[t].top;for(i=t+1;i<r.currentPos.length&&r.currentPos[i].left-r.currentPos[t].left<r.ElementWidth;i++){r.TestedTop=Math.max(r.TestedTop,r.currentPos[i].top)}var s=r.scoreFunction(r);if(s>r.BestScore){r.IndexStart=t;r.IndexEnd=i;r.ElementTop=r.TestedTop;r.BestScore=s}}var u=n.position(),a={left:r.currentPos[r.IndexStart].left+r.xPadding,top:r.ElementTop+r.yPadding};if(u.top!=a.top||u.left!=a.left){var f={el:n,f:"css",d:0};if(r._animate&&!n.hasClass("noanim")){var l=n.offset(),c={left:a.left+(l.left-u.left),top:a.top+(l.top-u.top)};if(l.top+r.ElementHeight>r.viewportY&&l.top<r.viewportYH||c.top+r.ElementHeight>r.viewportY&&c.top<r.viewportYH){f.f="animate";f.d=r.currentDelay;++r.iteration;r.currentDelay+=r.elementDelay}}f.style=a;r.styleQueue.push(f)}--r.iteration;var h=r.currentPos[r.IndexEnd-1].top,p=r.currentPos[r.IndexEnd]?r.currentPos[r.IndexEnd].left:r.containerWidth,d=r.currentPos[r.IndexStart].left+r.ElementWidth;r.currentPos[r.IndexStart].top=r.ElementTop+r.ElementHeight;if(d<p){r.currentPos.splice(r.IndexStart+1,r.IndexEnd-r.IndexStart-1,{left:d,top:h})}else{r.currentPos.splice(r.IndexStart+1,r.IndexEnd-r.IndexStart-1)}})},prepareElements:function(t,n,r){n.each(function(){var t=e(this);if(t.is(":visible")){t.css({display:"block"})}}).css({position:"absolute"})},applyStyles:function(t){var n;for(var r=0,i=t.styleQueue.length;r<i;r++){n=t.styleQueue[r];if(n.f=="animate"){n.el.delay(n.d).animate(n.style,e.extend(true,{},t.animationOptions))}else{n.el.css(n.style)}}},positionAll:function(n,r){if(e.isEmptyObject(r.contentToAppend)){var i=r.selector?n.children(r.selector):n.children()}else{var i=r.selector?r.contentToAppend.filter(r.selector):r.contentToAppend}r.ElementsCount=i.length;if(!r.ElementsCount){n.data("FreetilePos",null);if(typeof (r.callback=="function")){r.callback(r)}n[r._animate&&r.containerAnimate?"animate":"css"]({height:"0px"});return n}var s=n.css("display")||"";var o=n.css("visibility")||"";n.css({display:"block",width:"",visibility:"hidden"});r.containerWidth=n.width();var u=n.data("FreetilePos");r.currentPos=!e.isEmptyObject(r.contentToAppend)&&u?u:[{left:0,top:0}];r.xPadding=parseInt(n.css("padding-left"),10);r.yPadding=parseInt(n.css("padding-top"),10);r.viewportY=e(window).scrollTop();r.viewportYH=r.viewportY+e(window).height();r.iteration=i.length;r.currentDelay=0;r.styleQueue=[];r.animationOptions.complete=function(){if(--r.iteration<=0)r.callback(r)};i.each(function(t){if(r.fadeIn&&!e(this).hasClass("noanim")){e(this).fadeIn(r.fadeInSpeed)}});i.each(function(t){e(this).css({margin:r.gutter,display:"block"})});t.prepareElements(n,i,r);t.calculatePositions(n,i,r);t.applyStyles(r);var a={};if(s)a.display=s;if(o)a.visibility=o;if(n.css("position")=="static"){a.position="relative"}if(r.forceWidth&&r.containerWidthStep>0){a.width=r.containerWidthStep*parseInt(n.width()/r.containerWidthStep,10)}n.css(a);var f=e.map(r.currentPos,function(e,t){return e.top});a={height:Math.max.apply(Math,f)};if(r._animate&&r.containerAnimate){n.stop().animate(a,e.extend(true,{},r.animationOptions))}else{n.css(a)}if(r.iteration<=0)r.callback(r);n.data("FreetilePos",r.currentPos);i.addClass("tiled");return n},resetElementsStyle:function(t,n){var r;if(e.isEmptyObject(n.contentToAppend)){r=n.selector?t.children(n.selector):t.children()}else{r=n.selector?n.contentToAppend.filter(n.selector):n.contentToAppend}r.each(function(){e(this).attr("style","")})},defaults:{selector:"*",animate:false,elementDelay:0,containerResize:true,containerAnimate:false,customEvents:"",persistentCallback:false,forceWidth:false,containerWidthStep:1,loadCheckSelector:":not(.ignore-load-check)",gutter:0,fadeIn:false,fadeInSpeed:100,scoreFunction:function(e){return-e.TestedTop}},reset:{animationOptions:{complete:function(){}},callback:function(){},contentToAppend:{}}}})(jQuery);(function(e){"use strict";function t(){}function n(e,t){if(i)return t.indexOf(e);for(var n=t.length;n--;)if(t[n]===e)return n;return-1}var r=t.prototype,i=Array.prototype.indexOf?!0:!1;r._getEvents=function(){return this._events||(this._events={})},r.getListeners=function(e){var t,n,r=this._getEvents();if("object"==typeof e){t={};for(n in r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n])}else t=r[e]||(r[e]=[]);return t},r.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},r.addListener=function(e,t){var r,i=this.getListenersAsObject(e);for(r in i)i.hasOwnProperty(r)&&-1===n(t,i[r])&&i[r].push(t);return this},r.on=r.addListener,r.defineEvent=function(e){return this.getListeners(e),this},r.defineEvents=function(e){for(var t=0;e.length>t;t+=1)this.defineEvent(e[t]);return this},r.removeListener=function(e,t){var r,i,s=this.getListenersAsObject(e);for(i in s)s.hasOwnProperty(i)&&(r=n(t,s[i]),-1!==r&&s[i].splice(r,1));return this},r.off=r.removeListener,r.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},r.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},r.manipulateListeners=function(e,t,n){var r,i,s=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)s.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&("function"==typeof i?s.call(this,r,i):o.call(this,r,i));return this},r.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if("object"===n)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},r.emitEvent=function(e,t){var n,r,i,s=this.getListenersAsObject(e);for(r in s)if(s.hasOwnProperty(r))for(n=s[r].length;n--;)i=t?s[r][n].apply(null,t):s[r][n](),i===!0&&this.removeListener(e,s[r][n]);return this},r.trigger=r.emitEvent,r.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},"function"==typeof define&&define.amd?define(function(){return t}):e.EventEmitter=t})(this),function(e){"use strict";var t=document.documentElement,n=function(){};t.addEventListener?n=function(e,t,n){e.addEventListener(t,n,!1)}:t.attachEvent&&(n=function(t,n,r){t[n+r]=r.handleEvent?function(){var t=e.event;t.target=t.target||t.srcElement,r.handleEvent.call(r,t)}:function(){var n=e.event;n.target=n.target||n.srcElement,r.call(t,n)},t.attachEvent("on"+n,t[n+r])});var r=function(){};t.removeEventListener?r=function(e,t,n){e.removeEventListener(t,n,!1)}:t.detachEvent&&(r=function(e,t,n){e.detachEvent("on"+t,e[t+n]);try{delete e[t+n]}catch(r){e[t+n]=void 0}});var i={bind:n,unbind:r};"function"==typeof define&&define.amd?define(i):e.eventie=i}(this),function(e){"use strict";function t(e,t){for(var n in t)e[n]=t[n];return e}function n(e){return"[object Array]"===a.call(e)}function r(e){var t=[];if(n(e))t=e;else if("number"==typeof e.length)for(var r=0,i=e.length;i>r;r++)t.push(e[r]);else t.push(e);return t}function i(e,n){function i(e,n,o){if(!(this instanceof i))return new i(e,n);"string"==typeof e&&(e=document.querySelectorAll(e)),this.elements=r(e),this.options=t({},this.options),"function"==typeof n?o=n:t(this.options,n),o&&this.on("always",o),this.getImages(),s&&(this.jqDeferred=new s.Deferred);var u=this;setTimeout(function(){u.check()})}function a(e){this.img=e}i.prototype=new e,i.prototype.options={},i.prototype.getImages=function(){this.images=[];for(var e=0,t=this.elements.length;t>e;e++){var n=this.elements[e];"IMG"===n.nodeName&&this.addImage(n);for(var r=n.querySelectorAll("img"),i=0,s=r.length;s>i;i++){var o=r[i];this.addImage(o)}}},i.prototype.addImage=function(e){var t=new a(e);this.images.push(t)},i.prototype.check=function(){function e(e,i){return t.options.debug&&u&&o.log("confirm",e,i),t.progress(e),n++,n===r&&t.complete(),!0}var t=this,n=0,r=this.images.length;if(this.hasAnyBroken=!1,!r)return this.complete(),void 0;for(var i=0;r>i;i++){var s=this.images[i];s.on("confirm",e),s.check()}},i.prototype.progress=function(e){this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emit("progress",this,e),this.jqDeferred&&this.jqDeferred.notify(this,e)},i.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emit(e,this),this.emit("always",this),this.jqDeferred){var t=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[t](this)}},s&&(s.fn.imagesLoaded=function(e,t){var n=new i(this,e,t);return n.jqDeferred.promise(s(this))});var f={};return a.prototype=new e,a.prototype.check=function(){var e=f[this.img.src];if(e)return this.useCached(e),void 0;if(f[this.img.src]=this,this.img.complete&&void 0!==this.img.naturalWidth)return this.confirm(0!==this.img.naturalWidth,"naturalWidth"),void 0;var t=this.proxyImage=new Image;n.bind(t,"load",this),n.bind(t,"error",this),t.src=this.img.src},a.prototype.useCached=function(e){if(e.isConfirmed)this.confirm(e.isLoaded,"cached was confirmed");else{var t=this;e.on("confirm",function(e){return t.confirm(e.isLoaded,"cache emitted confirmed"),!0})}},a.prototype.confirm=function(e,t){this.isConfirmed=!0,this.isLoaded=e,this.emit("confirm",this,t)},a.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},a.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindProxyEvents()},a.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindProxyEvents()},a.prototype.unbindProxyEvents=function(){n.unbind(this.proxyImage,"load",this),n.unbind(this.proxyImage,"error",this)},i}var s=e.jQuery,o=e.console,u=o!==void 0,a=Object.prototype.toString;"function"==typeof define&&define.amd?define(["eventEmitter","eventie"],i):e.imagesLoaded=i(e.EventEmitter,e.eventie)}(window)
